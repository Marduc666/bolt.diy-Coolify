# Coolify-Optimized Docker Compose Configuration for bolt.diy
# This file is specifically designed for deployment on Coolify instances
# For standard Docker deployments, use docker-compose.yaml

services:
  bolt-ai:
    image: bolt-ai:production
    build:
      context: .
      dockerfile: Dockerfile
      target: bolt-ai-production
      args:
        # Coolify can inject these at build time
        - VITE_PUBLIC_APP_URL=${VITE_PUBLIC_APP_URL:-}
        - VITE_LOG_LEVEL=${VITE_LOG_LEVEL:-info}
        - DEFAULT_NUM_CTX=${DEFAULT_NUM_CTX:-32768}
    
    container_name: bolt-ai
    
    ports:
      - "${PORT:-5173}:5173"
    
    environment:
      # Application Settings
      - NODE_ENV=production
      - PORT=5173
      - HOST=0.0.0.0
      - RUNNING_IN_DOCKER=true
      
      # Logging & Performance
      - VITE_LOG_LEVEL=${VITE_LOG_LEVEL:-info}
      - DEFAULT_NUM_CTX=${DEFAULT_NUM_CTX:-32768}
      - WRANGLER_SEND_METRICS=false
      
      # Public URL (Coolify sets this automatically)
      - VITE_PUBLIC_APP_URL=${VITE_PUBLIC_APP_URL:-}
      
      # AI Provider API Keys - Cloud Providers
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - GOOGLE_GENERATIVE_AI_API_KEY=${GOOGLE_GENERATIVE_AI_API_KEY:-}
      - GROQ_API_KEY=${GROQ_API_KEY:-}
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY:-}
      - MISTRAL_API_KEY=${MISTRAL_API_KEY:-}
      - COHERE_API_KEY=${COHERE_API_KEY:-}
      - XAI_API_KEY=${XAI_API_KEY:-}
      - TOGETHER_API_KEY=${TOGETHER_API_KEY:-}
      - PERPLEXITY_API_KEY=${PERPLEXITY_API_KEY:-}
      - HuggingFace_API_KEY=${HuggingFace_API_KEY:-}
      - OPEN_ROUTER_API_KEY=${OPEN_ROUTER_API_KEY:-}
      - MOONSHOT_API_KEY=${MOONSHOT_API_KEY:-}
      - HYPERBOLIC_API_KEY=${HYPERBOLIC_API_KEY:-}
      - GITHUB_API_KEY=${GITHUB_API_KEY:-}
      
      # AWS Bedrock (JSON format)
      - AWS_BEDROCK_CONFIG=${AWS_BEDROCK_CONFIG:-}
      
      # Local AI Providers
      - OLLAMA_API_BASE_URL=${OLLAMA_API_BASE_URL:-}
      - LMSTUDIO_API_BASE_URL=${LMSTUDIO_API_BASE_URL:-}
      - OPENAI_LIKE_API_BASE_URL=${OPENAI_LIKE_API_BASE_URL:-}
      - OPENAI_LIKE_API_KEY=${OPENAI_LIKE_API_KEY:-}
      - TOGETHER_API_BASE_URL=${TOGETHER_API_BASE_URL:-}
      - HYPERBOLIC_API_BASE_URL=${HYPERBOLIC_API_BASE_URL:-https://api.hyperbolic.xyz/v1/chat/completions}
      
      # Integration Services (Optional)
      - VITE_GITHUB_ACCESS_TOKEN=${VITE_GITHUB_ACCESS_TOKEN:-}
      - VITE_GITHUB_TOKEN_TYPE=${VITE_GITHUB_TOKEN_TYPE:-classic}
      - VITE_GITLAB_ACCESS_TOKEN=${VITE_GITLAB_ACCESS_TOKEN:-}
      - VITE_GITLAB_URL=${VITE_GITLAB_URL:-https://gitlab.com}
      - VITE_GITLAB_TOKEN_TYPE=${VITE_GITLAB_TOKEN_TYPE:-personal-access-token}
      - VITE_VERCEL_ACCESS_TOKEN=${VITE_VERCEL_ACCESS_TOKEN:-}
      - VITE_NETLIFY_ACCESS_TOKEN=${VITE_NETLIFY_ACCESS_TOKEN:-}
      - VITE_SUPABASE_URL=${VITE_SUPABASE_URL:-}
      - VITE_SUPABASE_ANON_KEY=${VITE_SUPABASE_ANON_KEY:-}
      - VITE_SUPABASE_ACCESS_TOKEN=${VITE_SUPABASE_ACCESS_TOKEN:-}
    
    # Health check configuration
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5173/"]
      interval: 10s
      timeout: 3s
      start_period: 30s
      retries: 5
    
    # Restart policy
    restart: unless-stopped
    
    # Resource limits (adjust based on your needs)
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 4G
        reservations:
          cpus: '2'
          memory: 2G
    
    # Network configuration
    extra_hosts:
      - "host.docker.internal:host-gateway"
    
    # Optional: Persistent storage for user data
    # Uncomment if you need to persist data across deployments
    # volumes:
    #   - bolt-data:/app/data
    
    # Labels for Coolify integration
    labels:
      - "coolify.managed=true"
      - "coolify.version=1.0"
      - "coolify.type=application"
      - "coolify.name=bolt-ai"
      - "coolify.description=AI-powered full-stack web development"
      - "coolify.documentation=https://stackblitz-labs.github.io/bolt.diy/"

# Uncomment if using persistent volumes
# volumes:
#   bolt-data:
#     driver: local
